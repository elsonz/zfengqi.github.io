---
title: 计算机网络基础
date: 2015-09-07
updated: 2015-09-07
categories: "基础"
tags: ["计算机网络"]
---
非科班学生尝试恶补计算机网络基础，未完待续《计算机网络简明教程》
<!-- more -->
> **from 《计算机网络简明教程》 —— 谢希仁**


## ISP (Internet Service Provider)
1. 可从英特网管理机构申请到成块的IP地址
2. 同时拥有通信线路（大的ISP自己造，小的租）
3. “上网”指的是通过某个ISP接入到因特网。
4. IP地址管理机构不零售单个IP地址给个人用户，而是批发给ISP,由ISP再进行零售
5. **NAP网络接入点**：为了使不同层次ISP经营的网络能够互通
6. 相隔较远的两台主机的通信可能需要经过多个ISP

ISP级别 | 作用 | 说明
------- | ----| ---
第一层ISP | 最高级别，一般覆盖国家 | 拥有高速主干网
第二层ISP | 包括一些大公司 | 都是第一层ISP的用户
本地ISP（第三层）| 包括校园网、企业网和拨号上网的用户 | 只拥有本地网络，是第二层ISP的用户


## 因特网的组成
1. 边缘部分
  * 连接在因特网上的所有主机（又称端系统），这些主机可以是pad、大型计算机，也可以是ISP
  * 边缘部分利用核心部分所提供的服务，使主机之间能够互相通信。
  * 端系统的通信方式： 客户端-服务器方式（C/S，注B/S是其一种特例）和对等方式（P2P）
2. 核心部分
  * 向网络边缘提供连通性，核心主干是路由器
  * 路由器是实现分组（包）交换的关键构件，其任务是转发收到的分组。
  * 路由器不属于主机，主机的用途是为用户进行信息处理的，并且可以和其他主机通过网络交换信息。
  * 分组交换采用 **存储转发** 技术，要发送的整块数据成为一个 **报文**，发送报文之前，先把较长的报文划分成为一个个更小的等长数据段，在每个数据段前面，加上一些由必要的控制信息组成的 **首部** 后，构成一个 **分组**，也成为 **包(packet)**
  * 分组交换与电路交换相比的优点

## 什么是带宽
- 用来表示网络的通信线路所能传送数据的能力
- 单位时间内从网络的某一点到另一点所能通过的 **“最高数据率”**
- 单位为 b/s ... Gb/s

## 五层协议体系结构

### 1. 应用层
  - 直接为用户的应用进程（即正在运行的软件程序）提供服务。
  - 包括HTTP SMTP FTP...

### 2. 传输层
  - 负责向两台主机中的进程之间（端对端）的提供可靠报文传输和错误恢复。
  - 复用：多个应用层进程可同时使用下面传输层的服务；
  - 分用：传输层把收到的信息分别交付给上面应用层中相应的进程。
  - **TCP：**面向连接，数据传输的单位是**报文段(segment)**
  - **UDP：**无连接，传输单位为**用户数据报**，尽最大努力交付

### 3. 网络层(也称网际层 IP层)
  - 负责为不同的主机之间提供通信服务，注意只精确到主机之间而非指定进程
  - 把传输层产生的报文段或用户数据报封装成分组或包进行传输。也称为IP数据报
  - 另一个任务是：使主机传输层所传下来的包，能够通过网络中的路由器找到合适的路由，最后到达目的主机。即寻路。

#### 网络层不保证服务质量
 - 向上只提供简单灵活、无连接的、尽最大努力交付的数据报服务
 - 当主机中的进程之间的通信需要是可靠的时，就由主机中的传输层负责提供可靠传输

#### IP地址(IPv4)
最初使用分类的IP地址，先已普遍采用无分类编址方法

**分类地址：** 网络号 + 主机号 共32位

地址类别 | 网络号字段 | 主机号字段
--- | --- | --- | ---
A类地址 | 0 + 网络号（共8位 1字节） | 主机号(共24位)
B类地址 | 10 + 网络号（共16位 2字节） | 主机号(共16位)
C类地址 | 110 + 网络号（共24位 3字节） | 主机号(共8位)
D类地址 | 1110  | 多播地址
E类地址 | 1111  | 保留位今后使用

**点分十进制记法：** 如128.11.3.31
1. 每8位用其等效的十进制数表示，并在这些数之间加一个点。
2. 第一个十进制数：0~127是A类； 128~191是B类；192~223C类； 224~239D类； 240~255E类

**IP地址与MAC地址**
- IP地址：并不仅仅指明一台主机，还指明了主机所连接到的网络。
- MAC地址：仅仅指明一台主机，与该主机所连接的网络毫无关系。

#### ARP是地址解析协议，简单语言解释一下工作原理。
1. 首先，每个主机都会在自己的ARP缓冲区中建立一个ARP列表，以表示IP地址和MAC地址之间的对应关系。
2. 当源主机要发送数据时，首先检查ARP列表中是否有对应IP地址的目的主机的MAC地址，如果有，则直接发送数据，如果没有，就向本网段的所有主机发送ARP数据包，该数据包包括的内容有：源主机 IP地址，源主机MAC地址，目的主机的IP 地址。
3. 当本网络的所有主机收到该ARP数据包时，首先检查数据包中的IP地址是否是自己的IP地址，如果不是，则忽略该数据包，如果是，则首先从数据包中取出源主机的IP和MAC地址写入到ARP列表中，如果已经存在，则覆盖，然后将自己的MAC地址写入ARP响应包中，告诉源主机自己是它想要找的MAC地址。
4. 源主机收到ARP响应包后。将目的主机的IP和MAC地址写入ARP列表，并利用此信息发送数据。如果源主机一直没有收到ARP响应数据包，表示ARP查询失败。

广播发送ARP请求，单播发送ARP响应。

#### IP层转发分组的流程

#### 虚拟专用网 VPN
**背景**
1. IP地址紧缺，公司或机构所申请到的IP地址数远小于所拥有的主机数；
2. 一个机构内并不需要把所有主机都接入到外部因特网，很多主机只需要和公司内部其他主机通信
3. 因此可以让这些主机使用仅在公司内部有效的IP地址（本地地址），而不需要全球地址。

RFC1918指明了一些**专用地址(可重用地址)**：这些地址只能用于一个机构的内部通信，而不能用于和因特网上的主机通信。
**在因特网中的所有路由器，对目的地址是专用地址的数据报一律不进行转发**，避免自行分配的本地地址和全球地址相冲突。

```
10.0.0.0 ~ 10.255.255.255
172.16.0.0 ~ 172.31.255.255
192.168.0.0 ~ 192.168.255.255
```

分布在不同地点的专用网若需要进行通信，可使用IP隧道技术实现(P112)

### 4. 数据链路层
  - 将网络层交下来的IP数据报组装成 **帧(frame)**(添加首部和尾部)，在两个相邻节点间的链路上“透明”地传送帧中的数据。
  - **每一帧** 包括数据和必要的控制信息（如同步信息、地址信息、差错控制等），典型帧长为几百到一千多字节
  - 控制信息使接收端能够知道一个帧从哪个bit开始和到哪个bit结束。这样链路层在收到一个帧后，就可以从中提取出数据部分，上交给网络层。A
  - 控制信息还使接收端能够检测到所收到的帧中有无错误，并且可以纠正。
  ---
#### 链路和数据链路并不是一回事
**链路：** 从一个结点到相邻结点的一段物理线路，而中间没有任何其他的交换结点。

**数据链路：** 链路 + 实现必要通信协议的硬件和软件（用来控制数据的传输），一般使用网络适配器来实现这些协议的硬件和软件。

**网络适配器（简称网卡）：** 拨号上网 —— 拨号适配器； 以太网上网 —— 局域网适配器

#### 透明传输
如果数据链路层协议允许所传送的数据可具有任意形式的比特组合（即使出现了和帧首部或帧尾部标记完全一样的比特组合，协议也会采取适当的措施来处理）。
这样的传输称为透明传输。

### 5. 物理层
  - 任务是传送比特流
  - 需要考虑的是用多大电压代表1或0，以及接收方如何识别出发送方所发送的bit
  - **注意：** 传递信息所利用的物理媒介，如光缆、电缆、无线信道等，并不包含在物理层协议当中，而是在物理层协议的下面。所以也可以将物理媒介当做第0层。
