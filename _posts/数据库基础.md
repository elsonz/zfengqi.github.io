---
title: 数据库基础
date: 2015-09-05
updated: 2015-09-05
categories: "基础"
tags: ["数据库"]
---
同是基础恶补系列，阅读[《漫画数据库》](http://book.douban.com/subject/4829597/)做的笔记，书很薄，以漫画故事的形式讲述，对数据库有个大体的了解
<!-- more -->
## 一. 什么是数据库
### (1) 数据模型的种类
- 层次数据模型: 每个子数据只能有一个母数据
- 网状数据模型：可以有多个母数据

以上两种都是通过指针连接数据表示他们的关系；难以灵活高效地检索数据
- 关系数据模型 —— 当今主流数据库模型

### (2) 关系数据模型——使用表格
1. 以二元表格(table)为基础
2. 在关系数据模型中，称表格为关系(relation)
3. 主键(primary key): 能够唯一确定数据的列

### (3) 关系数据库的运算操作 —— 抽取数据的方式
1~4为集合运算，5~8为关系运算
#### 1. 并(union)
抽取两张表中所有行的运算

#### 2. 差(difference)
抽取两张表的其中一张表独有行的运算，以不同的表为基准会获得不同的运算结果

#### 3. 交(intersection)
抽取两张表中都存在的行(记录)

#### 4. 笛卡尔积(Cartesian product)
将两张表中的所有行进行排列组合

表一 & 表二

商品编码 | 商品名称 | 单价 | ←表一 & 表二→   | 出口国编号 | 出口国名称
--- | --- | --- | --- | --- | --- | --- |
101 | 香瓜 | 800G |  | 12 | 美国
102 | 草莓 | 123G |  | 23 | 阿富汗
103 | 苹果 | 545G |  | 25 | 巴基斯坦

笛卡尔积后，表一的每一行记录会与表二的每一行记录进行组合，形成3*3=9行的新表

#### 5. 投影(projection)
抽取一张表中的某一列，如抽取上表一种的商品名称列


#### 6. 选择(selection)
抽取表中的某一行

#### 7. 连接(join)
商品表 & 销售表

商品编码 | 商品名称 | 单价 | ←商品表 & 销售表→   | 日期 | 商品编码 | 数量
--- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
101 | 香瓜 | 800G |  | 11/1 | 102 | 1100
102 | 草莓 | 150G |  | 11/1 | 101 | 300
103 | 苹果 | 120G |  | 11/5 | 103 | 1700
104 | 柠檬 | 120G |  | 11/8 | 101 | 500

两张表都有共同的字段 **商品编码**，但销售表并没有 **商品名称** 字段

*销售表* 可以通过参考 *商品表* 中作为主键的 **商品编码** 来找到每条记录所对应的商品名称。

此时，销售表中的商品编码字段就叫做 **外键(foreign key)**

外键参照其他表的主键时，通过连接，可以将两张表粘合成如下新表

日期 | 商品编码 | 商品名称 |  单价  | 数量
--- | --- | --- | --- | --- | --- |
11/1 | 102 | 草莓 | 150G | 1100
11/1 | 101 | 香瓜 | 800G | 300
11/5 | 103 | 苹果 | 120G | 1700
11/8 | 101 | 香瓜 | 800G | 500

#### 8. 除(division)
1. 从“被除表格”当中抽取“除表格”中的所有行
2. 然后再从中去掉“除表格”中所包含的字段
3. 最后剩下的就是除运算后的结果

## 二、设计数据库

### E-R模型分析

### 规范化
第一范式：分割非范式的表格，得到第一范式表格？？

第二范式：主键的值（有可能两个字段组合起来作为主键）可以用来确定其他列的值，用这个原则来分割表格

第三范式


## 三、SQL基本操作

### 1. `SELECT`
紧跟着SELECT的是某个字段
``` SQL
SELECT * FROM `table1` // *代表所有字段
SELECT `country` FROM `table1` // 把表1中country字段的所有记录调取出来
SELECT AVG(单价) FROM `table1` // 使用计算函数作为一个字段，注意“单价”不用加引号！
```
#### **常见的计算函数**

计算函数 | 含义
--- | ---
COUNT(*****) | 求行数
COUNT(字段名) | 求非空值行数
COUNT(DISTINCT 字段名) | 求排除空值和重复行的行数
SUM(字段名) | 求各行的和 (若内容不为num，则结果为0)
AVG(字段名) | 平均值
MAX(字段名) | 最大值
MIN(字段名) | 最小值

#### `WHERE`  注意条件为数字和字符串时的处理
``` SQL
SELECT * FROM `table1` WHERE `name` = '苹果'
SELECT * FROM `table1` WHERE `price` < 200
SELECT * FROM `table1` WHERE `price` < > 200    // 价格不等于200
SELECT * FROM `table1` WHERE NOT `price` = 200  // 同上
SELECT * FROM `table1` WHERE `price` BETWEEN 150 AND 200 // 设范围

SELECT * FROM `table1` WHERE `price` IS NULL // 检索空值
```

#### `LIKE` **%** 表示任意多个字符； **_** 表示单个字符
``` SQL
SELECT * FROM `table1`
WHERE `name` LIKE '_果'
OR `name` LIKE '猕%'
```

#### `ORDER BY` 调取出来的结果按升序排列
``` SQL
SELECT * FROM `table1` WHERE `name` LIKE '%果' OR `name` LIKE '%莓' ORDER BY `price`
```

#### `GROUP BY`
将数据分组化，可以求出每一组的统计值

`HAVING` 对分组后求得的统计值进行进一步条件设定(注意不是使用`WHERE`)
``` SQL
// 可以求出每个地域的平均单价，如南部 北部 中部
SELECT `地域`, AVG(单价) FROM `table1` GROUP BY `地域`

// 若不加GROUP BY 则只会出现一条记录，均价是所有地域的均价
SELECT `地域`, AVG(单价) FROM `table1`

// 只抽取出平均单价在200以上的地域
SELECT `地域`, AVG(单价) FROM `table1`
GROUP BY `地域`
HAVING AVG(单价) >= 200
```

#### 子查询
例子：检索销售数量在1000以上的商品的名称
``` SQL
SELECT * FROM `商品表`
WHERE `商品编码` IN
(SELECT `商品编码` FROM `销售明细表` WHERE `数量` > 1000)
```

#### 相关子查询

### 2. `INSERT INTO`
``` SQL
INSERT INTO `商品表` (商品编码, 商品名称, 单价)
VALUES (202， '枇杷', 900)
```

### 3. `UPDATE`
``` SQL
UPDATE `商品表`
SET `商品名称` = '甜瓜'
WHERE `商品名称` = '西瓜'
```

### 4. `DELETE FROM`
``` SQL
DELETE FROM `商品表`
WHERE `商品名称` = '苹果'
```

### 5. `CREATE TABLE`

## 四、数据库应用
### 1. 事务(transaction)
用户的一个连贯操作被称之为数据库事务。

#### 数据库事务ACID属性
性质 | 内容 | 含义
--- | --- | ---
A(Atomicity) | 原子性 | 数据库事务必须结束于 **提交(commit)或回滚(rollback)** 中的任意一个任务
C(Consistency) | 一致性 | 使数据不发生矛盾，事务执行前数据库不存在矛盾，执行后也不能出现矛盾
I(Isolation) | 隔离性 | 两个事务的执行时互不干扰，一个事务不可能看到其他事务运行时，中间某一时刻的数据
D(Durability) | 持久性 | 在事务完成后，该事务对数据库所做的更改便持久的保存在数据库中，并不会被回滚

#### 可序列化
即便是多个事务并行处理也和逐个处理得到的结果一样时，逐个安排称之为可序列化。

并行执行控制：
- 读取数据-共享锁(其他用户只能读取，不能写入)；
- 写入数据-独占锁(其他用户读取写入都不允许)

### 2. 操作权限的赋予与收回
#### `GRANT` & `REVOKE`
``` SQL
GRANT SELECT, UPDATE, INSERT, DELETE ON 表名 TO 用户
GRANT ALL ON 表名 TO 用户 // 所有权限
REVOKE DELETE ON 表名 TO 用户X // 收回权限

// 能够赋予其他用户权限
GRANT SELECT, UPDATE ON 表名 TO 用户 WITH GRANT OPTION
```

### 3. 使用索引进行快速检索
在从大量的数据中选择其中一部分数据的情况下，使用索引可以进行快速检索
